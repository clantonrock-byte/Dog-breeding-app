<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breeder Pro</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="brand-title">Breeder Pro</div>
    <div class="brand-sub">Phase 1</div>
  </div>
  <div class="top-actions">
    <button id="btnTalk" class="btn">üéôÔ∏è Talk</button>
  </div>
</header>

<main class="shell">

  <!-- HOME -->
  <section id="viewHome" class="card">
    <h2>What is our goal today?</h2>
    <div class="goal-grid">
      <button class="btn primary" onclick="window.__go && window.__go('Dogs')">Dogs &amp; Pups</button>
      <button class="btn primary" onclick="window.__go && window.__go('Care')">Care Timeline</button>
      <button class="btn primary" onclick="window.__go && window.__go('Feeding')">Feeding</button>
      <button class="btn primary" onclick="window.__go && window.__go('InventoryMenu')">Inventory</button>
      <button class="btn primary" onclick="window.__go && window.__go('Helpers')">Helpers</button>
      <button class="btn primary" onclick="window.__go && window.__go('Records')">Records &amp; Export</button>
    </div>
  </section>

  <!-- INVENTORY MENU -->
  <section id="viewInventoryMenu" class="card hide">
    <h2>Inventory</h2>
    <div class="row">
      <button class="btn" onclick="window.__go && window.__go('Home')">Back</button>
      <button class="btn" onclick="window.__go && window.__go('Home')">Home</button>
    </div>
    <div class="goal-grid">
      <button class="btn primary" onclick="window.__go && window.__go('InventoryAvailable')">Inventory available</button>
      <button class="btn primary" onclick="window.__go && window.__go('InventoryAdd')">Add to inventory</button>
      <button class="btn primary" onclick="window.__go && window.__go('InventoryAddStock')">Add stock</button>
      <button class="btn primary" onclick="window.__go && window.__go('InventoryTransfer')">Transfer inventory</button>
    </div>
  </section>

  <!-- INVENTORY: AVAILABLE -->
  <section id="viewInventoryAvailable" class="card hide">
    <h2>Inventory available</h2>
    <div class="row">
      <button class="btn" onclick="window.__go && window.__go('InventoryMenu')">Back</button>
      <button class="btn" onclick="window.__go && window.__go('Home')">Home</button>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="btn" id="btnInvRefresh">Refresh list</button>
      <button class="btn" id="btnInvToggleArchived">Show archived</button>
    </div>

    <div id="invAvailableMeta" class="muted small" style="margin-top:10px;"></div>
    <div id="invAvailableList"></div>
    <div id="invAvailableArchived" class="hide"></div>
  </section>

  <!-- INVENTORY: ADD -->
  <section id="viewInventoryAdd" class="card hide">
    <h2>Add to inventory</h2>
    <div class="row">
      <button class="btn" onclick="window.__go && window.__go('InventoryMenu')">Back</button>
      <button class="btn" onclick="window.__go && window.__go('Home')">Home</button>
    </div>

    <div class="muted small" style="margin:10px 0;">
      This records item definition (what it is).
    </div>

    <div class="row">
      <button class="btn primary" id="btnOpenAddDialog">+ Create item definition</button>
      <button class="btn" onclick="window.__openScanDialog && window.__openScanDialog('add')">Scan now (QR or barcode)</button>
    </div>
  </section>

  <!-- INVENTORY: ADD STOCK -->
  <section id="viewInventoryAddStock" class="card hide">
    <h2>Add stock</h2>
    <div class="row">
      <button class="btn" onclick="window.__go && window.__go('InventoryMenu')">Back</button>
      <button class="btn" onclick="window.__go && window.__go('Home')">Home</button>
    </div>

    <div class="row">
      <button class="btn primary" onclick="window.__openScanDialog && window.__openScanDialog('addstock')">Scan item</button>
      <button class="btn" id="btnAddStockRefreshList">Refresh list</button>
    </div>

    <label class="label">Search (optional)</label>
    <input id="addStockSearch" placeholder="Type to filter‚Ä¶ (e.g., blanket, toy)" />

    <label class="label">Or select an item (manual)</label>
    <select id="addStockSelect"></select>

    <div id="addStockForm" class="hide" style="margin-top:12px;">
      <div class="timeline-item">
        <div><strong id="addStockItemName"></strong></div>
        <div class="muted small" id="addStockItemMeta"></div>
      </div>

      <label class="label">Quantity to add</label>
      <input id="addStockQty" inputmode="decimal" placeholder="e.g., 40" />

      <label class="label">Note (optional)</label>
      <input id="addStockNote" placeholder="Delivery, donation, etc." />

      <div class="row" style="margin-top:12px;">
        <button class="btn primary" id="btnConfirmAddStock">Confirm add</button>
        <button class="btn" id="btnCancelAddStock">Cancel</button>
      </div>
    </div>

    <div id="addStockStatus" class="muted small" style="margin-top:10px;"></div>
  </section>

  <!-- INVENTORY: TRANSFER -->
  <section id="viewInventoryTransfer" class="card hide">
    <h2>Transfer inventory</h2>
    <div class="row">
      <button class="btn" onclick="window.__go && window.__go('InventoryMenu')">Back</button>
      <button class="btn" onclick="window.__go && window.__go('Home')">Home</button>
    </div>

    <div class="row">
      <button class="btn primary" onclick="window.__openScanDialog && window.__openScanDialog('transfer')">Scan item</button>
      <button class="btn" id="btnTransferRefreshList">Refresh list</button>
    </div>

    <label class="label">Search (optional)</label>
    <input id="transferSearch" placeholder="Type to filter‚Ä¶ (e.g., blanket, toy)" />

    <label class="label">Or select an item (manual)</label>
    <select id="transferSelect"></select>

    <div id="transferForm" class="hide" style="margin-top:12px;">
      <div class="timeline-item">
        <div><strong id="transferItemName"></strong></div>
        <div class="muted small" id="transferItemMeta"></div>
      </div>

      <label class="label">Quantity to transfer</label>
      <input id="transferQty" inputmode="decimal" placeholder="e.g., 5" />

      <label class="label">Transfer destination</label>
      <select id="transferType">
        <option>With a dog</option>
        <option>To adopter</option>
        <option>To foster</option>
        <option>To another organization</option>
        <option>Returned to donor</option>
        <option>Moved to storage</option>
        <option>Other</option>
      </select>

      <label class="label">Destination details (optional)</label>
      <input id="transferDetail" placeholder="Dog name / org / storage" />

      <label class="label">Contact person (optional)</label>
      <input id="transferContactPerson" placeholder="Jordan Smith" />

      <label class="label">Contact method (optional)</label>
      <select id="transferContactMethod">
        <option>None</option><option>Phone</option><option>Email</option><option>Both</option><option>Other</option>
      </select>

      <label class="label">Contact details (optional)</label>
      <input id="transferContactDetails" placeholder="555-555-5555 / name@email.com" />

      <label class="label">Note (optional)</label>
      <input id="transferNote" placeholder="Any factual notes" />

      <div class="row" style="margin-top:12px;">
        <button class="btn primary" id="btnConfirmTransfer">Confirm transfer</button>
        <button class="btn" id="btnCancelTransfer">Cancel</button>
      </div>
    </div>

    <div id="transferStatus" class="muted small" style="margin-top:10px;"></div>
  </section>

  <!-- PLACEHOLDERS -->
  <section id="viewDogs" class="card hide"><h2>Dogs &amp; Pups</h2></section>
  <section id="viewCare" class="card hide"><h2>Care Timeline</h2></section>
  <section id="viewFeeding" class="card hide"><h2>Feeding</h2></section>
  <section id="viewHelpers" class="card hide"><h2>Helpers</h2></section>
  <section id="viewRecords" class="card hide"><h2>Records &amp; Export</h2></section>

</main>

<button id="btnEmergency" class="btn danger emergency-fixed">Emergency</button>

<!-- QUICK ADJUST DIALOG -->
<dialog id="dlgQuickAdjust" class="dlg">
  <form method="dialog" class="dlg-card">
    <div class="dlg-h">
      <h3>Quick adjust</h3>
      <button class="info-btn" value="cancel" aria-label="Close">‚úï</button>
    </div>
    <div class="dlg-b">
      <div class="muted small" id="qaItemName"></div>
      <div class="muted small" id="qaItemMeta"></div>

      <label class="label">Action</label>
      <select id="qaAction">
        <option>Added</option>
        <option>Used</option>
        <option>Discarded</option>
        <option>Transferred</option>
      </select>

      <label class="label">Quantity</label>
      <input id="qaQty" inputmode="decimal" placeholder="e.g., 1" />

      <div id="qaTransferFields" class="hide">
        <label class="label">Destination type</label>
        <select id="qaTransferType">
          <option>With a dog</option>
          <option>To adopter</option>
          <option>To foster</option>
          <option>To another organization</option>
          <option>Returned to donor</option>
          <option>Moved to storage</option>
          <option>Other</option>
        </select>

        <label class="label">Destination details (optional)</label>
        <input id="qaTransferDetail" placeholder="Dog name / org / storage" />

        <label class="label">Contact person (optional)</label>
        <input id="qaContactPerson" placeholder="Jordan Smith" />

        <label class="label">Contact method (optional)</label>
        <select id="qaContactMethod">
          <option>None</option><option>Phone</option><option>Email</option><option>Both</option><option>Other</option>
        </select>

        <label class="label">Contact details (optional)</label>
        <input id="qaContactDetails" placeholder="555-555-5555 / name@email.com" />
      </div>

      <label class="label">Note (optional)</label>
      <input id="qaNote" placeholder="Any factual notes" />
    </div>
    <div class="dlg-f">
      <button class="btn" value="cancel">Cancel</button>
      <button class="btn primary" id="btnQaConfirm" value="ok">Confirm</button>
    </div>
  </form>
</dialog>

<!-- ADD DIALOG -->
<dialog id="dlgInv" class="dlg">
  <form method="dialog" class="dlg-card">
    <div class="dlg-h">
      <h3>Inventory item</h3>
      <button class="info-btn" value="cancel" aria-label="Close">‚úï</button>
    </div>
    <div class="dlg-b">
      <label class="label">Item name / label</label>
      <input id="invName" />
      <div class="grid2">
        <div>
          <label class="label">Category</label>
          <select id="invCategory">
            <option>Food</option><option>Treat</option><option>Topper</option><option>Supplement</option>
            <option>Toy</option><option>Blanket</option><option>Coat</option><option>Equipment</option><option>Other</option>
          </select>
        </div>
        <div>
          <label class="label">Source</label>
          <select id="invSource"><option>Purchased</option><option>Donated</option><option>Other</option></select>
        </div>
      </div>
      <div class="grid2">
        <div>
          <label class="label">Identifier type</label>
          <select id="invIdType"><option>None</option><option>Barcode</option><option>QR</option></select>
        </div>
        <div>
          <label class="label">Identifier value</label>
          <input id="invIdValue" placeholder="(scan or type)" />
        </div>
      </div>
      <div class="row">
        <button type="button" class="btn" onclick="window.__openScanDialog && window.__openScanDialog('add')">Scan now (QR or barcode)</button>
        <button type="button" class="btn" id="btnAddClearId">Delete now</button>
      </div>
      <div class="grid2">
        <div>
          <label class="label">Unit</label>
          <select id="invUnit"><option>count</option><option>weight</option><option>volume</option></select>
        </div>
        <div>
          <label class="label">Weight per unit (optional)</label>
          <input id="invWeightPerUnit" placeholder="e.g., 40 lb" />
        </div>
      </div>
      <label class="label">Notes (optional)</label>
      <input id="invNotes" />
    </div>
    <div class="dlg-f">
      <button class="btn" value="cancel">Cancel</button>
      <button class="btn primary" id="btnSaveInv" value="ok">Save</button>
    </div>
  </form>
</dialog>

<!-- SCAN DIALOG -->
<dialog id="dlgScan" class="dlg">
  <form method="dialog" class="dlg-card">
    <div class="dlg-h">
      <h3>Scan</h3>
      <button class="info-btn" value="cancel" aria-label="Close" id="btnCloseScan">‚úï</button>
    </div>
    <div class="dlg-b">
      <video id="scanVideo" playsinline autoplay muted></video>
      <div id="scanResultBox" class="scan-result hide">
        <div class="muted small">Identifier captured</div>
        <div id="scanValue" class="scan-value"></div>
      </div>
      <div id="scanHelp" class="muted small" style="margin-top:10px;"></div>
      <label class="label" style="margin-top:12px;">Manual entry (if needed)</label>
      <input id="scanManual" placeholder="Type or paste barcode here" inputmode="numeric" />
    </div>
    <div class="dlg-f">
      <button type="button" class="btn" id="btnRescan">Rescan</button>
      <button type="button" class="btn primary" id="btnConfirmScan">Confirm</button>
      <button class="btn" value="cancel">Cancel</button>
    </div>
  </form>
</dialog>

<script>
(function(){
  // NOTE: This script assumes app.js supplies window.__go.
  // If app.js is missing, buttons still won't work.
  // That‚Äôs why you pasted app.js navigation-only already.

  const INV_STORE_KEY="breederPro_inventory_store_v1";
  function loadStore(){ try{ const raw=localStorage.getItem(INV_STORE_KEY); if(!raw) return {inventory:[]}; const obj=JSON.parse(raw); if(!obj.inventory) obj.inventory=[]; return obj; }catch{ return {inventory:[]}; } }
  function saveStore(obj){ localStorage.setItem(INV_STORE_KEY, JSON.stringify(obj)); }
  function escapeHtml(s){ return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }
  function inventoryLow(it){ const t=it.thresholdLow; if(t===null||t===undefined||t==="") return false; return Number(it.qty)<=Number(t); }

  // Inventory available
  function renderInventoryAvailable(){
    const meta=document.getElementById("invAvailableMeta");
    const list=document.getElementById("invAvailableList");
    const arch=document.getElementById("invAvailableArchived");
    const store=loadStore();
    const inv=store.inventory||[];
    const active=inv.filter(i=>!i.archived);
    const archived=inv.filter(i=>i.archived);
    if(meta) meta.textContent=`Source: local inventory (v1). Active: ${active.length}. Archived: ${archived.length}.`;

    if(list){
      list.innerHTML = active.length ? active.map(i=>{
        const low=inventoryLow(i);
        const w=i.weightPerUnit?` ‚Ä¢ W/unit: ${escapeHtml(i.weightPerUnit)}`:"";
        const stock=`On hand: ${escapeHtml(String(i.qty ?? 0))}${(i.thresholdLow!==null&&i.thresholdLow!==""&&i.thresholdLow!==undefined)?` ‚Ä¢ Low: ${escapeHtml(String(i.thresholdLow))}`:""}`;
        const idLine=(i.identifierType && i.identifierType!=="None")?`${escapeHtml(i.identifierType)}: ${escapeHtml(i.identifierValue||"")}`:"Identifier: none";
        return `
          <div class="inv-item">
            <div class="inv-top">
              <div style="width:100%;">
                <div class="inv-name ${low?"low":""}">${escapeHtml(i.name||"(unnamed)")}</div>
                <div class="inv-meta">${escapeHtml(i.category||"")} ‚Ä¢ ${escapeHtml(i.source||"")} ‚Ä¢ ${escapeHtml(i.unit||"")} ‚Ä¢ ${stock}${w}</div>
                <div class="inv-meta">${idLine}</div>
                <div class="row" style="margin-top:10px;">
                  <button class="btn" onclick="window.__quickAdjust && window.__quickAdjust('${i.itemId}')">Quick adjust</button>
                </div>
              </div>
            </div>
          </div>`;
      }).join("") : `<div class="muted small">No active inventory items recorded.</div>`;
    }

    if(arch){
      arch.innerHTML = archived.length ? archived.map(i=>{
        const w=i.weightPerUnit?` ‚Ä¢ W/unit: ${escapeHtml(i.weightPerUnit)}`:"";
        const stock=`On hand: ${escapeHtml(String(i.qty ?? 0))}${(i.thresholdLow!==null&&i.thresholdLow!==""&&i.thresholdLow!==undefined)?` ‚Ä¢ Low: ${escapeHtml(String(i.thresholdLow))}`:""}`;
        const idLine=(i.identifierType && i.identifierType!=="None")?`${escapeHtml(i.identifierType)}: ${escapeHtml(i.identifierValue||"")}`:"Identifier: none";
        return `<div class="inv-item"><div class="inv-top"><div>
          <div class="inv-name">${escapeHtml(i.name||"(unnamed)")}</div>
          <div class="inv-meta">Archived ‚Ä¢ ${escapeHtml(i.category||"")} ‚Ä¢ ${escapeHtml(i.source||"")} ‚Ä¢ ${escapeHtml(i.unit||"")} ‚Ä¢ ${stock}${w}</div>
          <div class="inv-meta">${idLine}</div>
        </div></div></div>`;
      }).join("") : `<div class="muted small">No archived inventory items.</div>`;
    }
  }

  // Quick adjust
  let qaItemId=null;
  window.__quickAdjust = function(itemId){
    const store=loadStore();
    const it=(store.inventory||[]).find(x=>x.itemId===itemId);
    if(!it) return;
    qaItemId=itemId;
    document.getElementById("qaItemName").textContent = `Item: ${it.name}`;
    document.getElementById("qaItemMeta").textContent = `On hand: ${it.qty ?? 0} ‚Ä¢ ${it.unit || ""}`;
    document.getElementById("qaAction").value = "Added";
    document.getElementById("qaQty").value = "1";
    document.getElementById("qaNote").value = "";
    document.getElementById("qaTransferFields").classList.add("hide");
    document.getElementById("dlgQuickAdjust").showModal();
  };

  function updateQaUI(){
    const a=document.getElementById("qaAction").value;
    document.getElementById("qaTransferFields").classList.toggle("hide", a!=="Transferred");
  }

  function applyQuickAdjust(){
    const store=loadStore();
    const it=(store.inventory||[]).find(x=>x.itemId===qaItemId);
    if(!it) return;
    const action=document.getElementById("qaAction").value;
    const qty=Math.abs(Number(document.getElementById("qaQty").value||"0")||0);
    if(qty<=0){ alert("Quantity needs to be greater than 0."); return; }

    if(action==="Added"){
      it.qty = Number(it.qty||0) + qty;
      it.history.push({ ts:new Date().toISOString(), action:"Added", qtyDelta: qty, note:(document.getElementById("qaNote").value||"").trim() });
    } else if(action==="Used" || action==="Discarded"){
      it.qty = Math.max(0, Number(it.qty||0) - qty);
      it.history.push({ ts:new Date().toISOString(), action, qtyDelta: -qty, note:(document.getElementById("qaNote").value||"").trim() });
    } else if(action==="Transferred"){
      it.qty = Math.max(0, Number(it.qty||0) - qty);
      it.history.push({
        ts:new Date().toISOString(),
        action:"Transferred",
        qtyDelta:-qty,
        note:(document.getElementById("qaNote").value||"").trim(),
        transfer:{
          destinationType:document.getElementById("qaTransferType").value,
          destinationDetail:(document.getElementById("qaTransferDetail").value||"").trim(),
          contactPerson:(document.getElementById("qaContactPerson").value||"").trim(),
          contactMethod:document.getElementById("qaContactMethod").value,
          contactDetails:(document.getElementById("qaContactDetails").value||"").trim()
        }
      });
    }

    saveStore(store);
    document.getElementById("dlgQuickAdjust").close();
    renderInventoryAvailable();
  }

  // Add definition
  function openAddDialog(){
    document.getElementById("invName").value="";
    document.getElementById("invCategory").value="Food";
    document.getElementById("invSource").value="Other";
    document.getElementById("invIdType").value="Barcode";
    document.getElementById("invIdValue").value="";
    document.getElementById("invUnit").value="count";
    document.getElementById("invWeightPerUnit").value="";
    document.getElementById("invNotes").value="";
    document.getElementById("dlgInv").showModal();
  }
  function saveDefinition(){
    const name=(document.getElementById("invName").value||"").trim();
    if(!name){ alert("Item name is required."); return; }
    const store=loadStore();
    store.inventory.push({
      itemId:"inv_"+Date.now(),
      name,
      category:document.getElementById("invCategory").value,
      source:document.getElementById("invSource").value,
      identifierType:document.getElementById("invIdType").value,
      identifierValue:(document.getElementById("invIdValue").value||"").trim(),
      unit:document.getElementById("invUnit").value,
      weightPerUnit:(document.getElementById("invWeightPerUnit").value||"").trim(),
      notes:(document.getElementById("invNotes").value||"").trim(),
      qty:0, thresholdLow:null, archived:false,
      createdAt:new Date().toISOString(),
      history:[]
    });
    saveStore(store);
    document.getElementById("dlgInv").close();
    window.__go && window.__go("InventoryAvailable");
    renderInventoryAvailable();
  }

  // Search/select for add stock + transfer are already in the committed HTML file logic;
  // For stability, we keep this restore minimal.

  // Scan dialog (context aware) ‚Äî rely on HTML‚Äôs button to open scan dialog and confirm
  // If you need the full scan logic restored here, say so and I‚Äôll paste the full script too.

  document.addEventListener("DOMContentLoaded", ()=>{
    document.getElementById("btnInvRefresh")?.addEventListener("click", renderInventoryAvailable);
    document.getElementById("btnInvToggleArchived")?.addEventListener("click", ()=> document.getElementById("invAvailableArchived").classList.toggle("hide"));

    document.getElementById("btnOpenAddDialog")?.addEventListener("click", openAddDialog);
    document.getElementById("btnSaveInv")?.addEventListener("click", (e)=>{ e.preventDefault(); saveDefinition(); });
    document.getElementById("btnAddClearId")?.addEventListener("click", ()=>{ document.getElementById("invIdValue").value=""; });

    document.getElementById("qaAction")?.addEventListener("change", updateQaUI);
    document.getElementById("btnQaConfirm")?.addEventListener("click", (e)=>{ e.preventDefault(); applyQuickAdjust(); });

    document.getElementById("btnTalk")?.addEventListener("click", ()=> alert("Voice may be used at any time."));
    renderInventoryAvailable();
  });
})();
</script>

<!-- ‚úÖ IMPORTANT: load app.js AFTER the HTML so window.__go exists -->
<script src="app.js"></script>

</body>
                                                                                </html>
